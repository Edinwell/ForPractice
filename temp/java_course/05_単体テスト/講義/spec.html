<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>単体テスト項目作成</title>
<link rel="stylesheet" type="text/css" href="../../css/main.css">
</head>

<body>

<center>
<h2>単体テスト仕様書</h2>
</center>
<hr>

<p class="midasi0">単体テスト仕様書作成</p>

それでは、「単体テスト仕様書」 についてさらに詳しく見ていきます。<br>
<br>
「単体テスト仕様書」 は、テスト項目を明確にする目的で作成されます。<br>
しかし、「単体テスト仕様書」 といっても、プロジェクトによって様々な形式や規則があり、<br>
「これが一番正しい様式です」と一概にいうことはできません。<br>
<br>
但し、どのような単体テスト仕様書でも、<br>
<ol>
	<li>前提条件</li>
	<li>実行内容</li>
	<li>期待結果</li>
</ol>
という３つの項目があり、この全てが明確にされて初めてひとつのテスト項目が作成されるのはほぼ共通です。<br>
前提条件によって実行パターンが分かれる場合は、全てのパターンを洗い出して、それぞれをテスト項目としていきます。<br>
<br>
今回の単体テストでは、パターンの洗い出しを行うために、「直交表 （ディシジョンテーブル）」 と呼ばれるものを使用します。<br>
また、テストクラスの中に記述した JavaDoc を、最終的な単体テスト仕様書とすることにします。<br>
<br>

<p class="midasi1">直交表</p>
初めて出てきた「直交表」というドキュメントですが、説明をする前に、既に入力済みの直交表をざっと眺めてみましょう。<br>
この直交表は、あるひとつのメソッドに対する単体テスト項目を表しています。<br>
<br>
シート上部にクラス名・メソッド名の記入欄があり、<br>
横方向に１～１５までの数字が入力され、縦方向には大きく「入力」「出力/結果」に分かれて、たくさんの項目が挙げられています。<br>
<br>
<img src="images/00_01.png" /><br>
<br>
この、１～１５までの列が、それぞれ１つの単体テスト項目を表します。<br>
このサンプルではNo.１～No.１５まで、１５個の単体テスト項目が挙げられています。<br>
<br>
次に縦軸の方を見ていきましょう。<br>
「入力」 と 「出力/結果」の部分に分かれています。<br>
<br>
「入力」 には、このメソッドに対して入力される可能性のあるパラメータを記述します。これが「前提条件」です。<br>
「出力/結果」には、メソッドの戻り値や、実行後に変更される状態などを記述します。これが、「期待結果」となります。<br>
<br>
ここでいう、 「前提条件」 と 「期待結果」 は、メソッドの振る舞いがこうある 「べき」 というものです。<br>
現在、 「不正な文字列を入力すると例外が起きる」 ため、 「出力は例外である」 とするわけではありません。<br>
<br>
「不正な文字列を入力された場合」 は、<br>
<ul>
<li>「例外が発生すべき」</li>
<li>「エラーメッセージが出力されるべき」</li>
<li>「偽という判定結果が出力されるべき」</li>
</ul>
というような複数の選択肢から、どれが正しいメソッドの振舞いであるかを明確にし、その仕様を元に記述する必要があります。<br>
<br>
直交表を用いて、条件や結果の一覧を作ることで、パターンの確認がしやすくなり、<br>
効率的なテスト項目の洗い出しを行ったり、テスト項目の漏れを発見したりすることができるようになります。<br>
<br>


<p class="midasi1">「入力」と「出力/結果」</p>
次に、直交表を作成する上で、 「入力」 と 「出力/結果」 に具体的にどのような項目をあげればよいかを考えてみます。<br>
<br>
まず、どのような役割のメソッドがあるかを調べます。<br>
MVC施設予約では、以下のような種類のメソッドが存在することがわかりました。<br>
<ul>
<li>単体として機能するユーティリティメソッド</li>
<li>データベースへアクセスするメソッド</li>
<li>リクエストやレスポンスを使用するサーブレットのメソッド</li>
</ul>
それぞれのメソッドに対する、入出力項目を挙げてみます。<br>
<br>
<table border="1" style="margin-top: 10px; margin-bottom: 10px;">
	<tr>
		<th style="width: 200px;">メソッドの種類</th>
		<th style="width: 250px;">入力</th>
		<th style="width: 250px;">出力/結果</th>
	</tr>
	<tr>
		<td>単体として機能するユーティリティメソッド</td>
		<td>
		<ul class="no_padding">
			<li>引数</li>
		</ul>
		</td>
		<td>
		<ul class="no_padding">
			<li>戻り値</li>
			<li>例外</li>
		</ul></td>
	</tr>
</table>
<br>
ユーティリティのような完全に独立したメソッドでは、入力は 「メソッドの引数」、出力は、メソッドの 「戻り値」 です。<br>
<br>
メソッドの外部からこれ以外の影響を受けたり、外部に影響するということはありませんので、項目はこれだけです。<br>
また、例外が発生する可能性のある場合 （throws 節などがある場合） は、例外も出力項目とします。<br>
<br>
<br>
<table border="1" style="margin-top: 10px; margin-bottom: 10px;">
	<tr>
		<th style="width: 200px;">メソッドの種類</th>
		<th style="width: 250px;">入力</th>
		<th style="width: 250px;">出力/結果</th>
	</tr>
	<tr>
		<td>データベース（ファイル）へアクセスするメソッド</td>
		<td>
		<ul class="no_padding">
			<li>引数</li>
			<li>DB（ファイル）の状態</li>
		</ul>
		</td>
		<td>
		<ul class="no_padding">
			<li>戻り値</li>
			<li>例外</li>
			<li>DB（ファイル）の状態</li>
			<li>トランザクション状態</li>
		</ul>
		</td>
	</tr>
</table>
<br>
DAOメソッドでは、ユーティリティメソッドと同じように「引数」や「戻り値」が入出力項目となります。<br>
<br>
しかし、「DB（ファイル）の状態」 という項目を、「入力」 と 「出力」 に追加しました。<br>
メソッドが参照である場合は、実行時の外部データベース（ファイル）の状態がメソッドの結果に影響し、<br>
また、メソッドが更新である場合には、メソッドの実行が、外部データベース（ファイル）に影響を与えるからです。<br>
<br>
このように、データアクセス用のメソッドは、実際のデータの参照や更新を 「入力」、「出力」 として確認する必要があります。<br>
今回のように、データベースであれば、レコードの参照や更新が行われることや、<br>
コミット、ロールバック、コネクションクローズなどのトランザクション管理がされていることを確認します。<br>
また、ファイル操作等を行うメソッドであれば、実際のファイルに対して仕様どおりにアクセスできることをテストします。<br>
<br>
<br>
<table border="1" style="margin-top: 10px; margin-bottom: 10px;">
	<tr>
		<th style="width: 200px;">メソッドの種類</th>
		<th style="width: 250px;">入力</th>
		<th style="width: 250px;">出力/結果</th>
	</tr>
	<tr>
		<td>リクエストやレスポンスを使用するサーブレットのメソッド</td>
		<td>
		<ul class="no_padding">
			<li>リクエストパラメータ</li>
			<li>リクエスト情報</li>
			<li>セッション情報</li>
			<li>呼び出しメソッド戻り値</li>
		</ul>
		</td>
		<td>
		<ul class="no_padding">
			<li>呼び出しメソッド引数</li>
			<li>リクエスト情報</li>
			<li>セッション情報</li>
			<li>遷移先情報</li>
			<li>例外</li>
		</ul>
		</td>
	</tr>
</table>
<br>
サーブレットメソッドは、DAO メソッドのように、実行によって外部に影響することはありません。<br>
また、ユーティリティメソッドとも違い、「引数」 は固定で、 「戻り値」 はなしです。<br>
メソッド内では、引数として入力される リクエストオブジェクトから入力を取得し、同じリクエストオブジェクトに対して出力を実施します。<br>
そのため、 リクエストオブジェクトやその関連オブジェクトが保持する値を、入出力項目としてそのまま使用します。<br>
<br>
また、メソッド内で、 ユーティリティクラスのメソッドや、DAO クラスのメソッドなどの外部メソッドを 利用するため、<br>
「呼び出しメソッド戻り値」、「呼び出しメソッド引数」という項目を挙げました。<br>
サーブレットの単体テストでは、ユーティリティメソッド や、DAO メソッドの外部的な仕様だけを利用してテストするためです。<br>
「呼び出すメソッドに対して的確な引数を渡したこと」、<br>
「呼び出したメソッドからの戻り値を使用して的確な処理を実施したこと」 のみを検証します。<br>
<br>
<br>

<p class="midasi1">テストデータ</p>
入出力項目が列挙できたら、各パターンごとにテストデータを考えてゆきます。<br>
テストデータを決める際には、以下のポイントに留意する必要があります。
<ul>
<li>具体的な値を使用する</li>
<li>同値分割、境界値分析 等の手法を理解して行う</li>
<li>メソッドの責任を考慮して、テストデータのパターンを考える</li>
</ul>

<h4>具体的な値を使用する</h4>
テストデータの記述では、テスト実施者によって解釈がまちまちとなるような記述は、できるだけ避けます。<br>
例えば、パスワード用のパラメータに対して、テストデータが「５文字以上の文字列」 とされた場合、<br>
「AAAAA」でも、「ああああああ」でも「ああ ああ」でも「\r\n\t 空白」でも「1234567890」でも、<br>
テストの入力条件に合致することになってしまい、テストデータとして使用される値がテスト作成者の意図とずれてしまうことがあります。<br>
<br>
そうはいっても、入力する文字列が数100文字に及ぶなどの場合は、記述のしようがない場合もあります。<br>
臨機応変に、かつ、テストの意図が明確になるような値をテストデータとして記入するようにします。<br>
<br>
<h4>同値分割、境界値分析 等の手法を理解して行う</h4>
<pre class="source">
if (a &lt; 30) { ...
</pre>
<br>
というようなコード（最大値）があった場合、「20」をテスト値として使用すると、<br>
「29」 までは、「真とされる」 こと、「30」 からは、「偽とされる」 ことが確認できません。<br>
境界値の決定方法を使用して、「30」、「29」 を使用します。<br>
<br>
<br>
また、どのような文字列でも処理が同じである場合に、<br>
<ol>
<li>「あいうえお」</li>
<li>「12345」</li>
<li>「 　（半角ブランク＋全角ブランク）」</li>
<li>「ABCDEFGHIJK」</li>
</ol>
というような文字種パターンを全て挙げても、テスト結果が変わらないことがあります。<br>
テストにかけられる時間と品質はトレードオフの関係であるため、できるだけの検証はすべきですが、<br>
「今回は、同じグループに属する」と判断した場合は、テスト値をばっさり切り捨てる判断も必要です。<br>
<br>

<h4>メソッドの責任を考慮して、テストデータのパターンを考える</h4>
以下のような観点で、テストデータのパターンを考えることがあると思います。<br>
<ol>
<li>値の型と長さ </li>
<li>値の未入力（null値や空文字、ホワイトスペース等） </li>
</ol>
全てのメソッドについて同じようにこのチェックが必要なのでしょうか。<br>
<br>
例えば、DAOメソッドの引数にnullが渡されたため、NullPointerException が発生したとしましょう。<br>
null や 長さ、型 に対する処理や、テストデータを考慮しなかった DAOメソッドに責任があるのでしょうか。<br>
実はこの責任は、DAOメソッドの仕様を無視して妥当でない入力をした サーブレットメソッド にあります。<br>
<br>
DAOは、妥当な入力に対して適切な処理を実行することが責任となるため、チェック済の妥当な値のみを想定、また、テスト対象とします。<br>
妥当な入力以外の、想定しない入力に対して、どのような仕様も決める必要はないため、<br>
実際には例外が発生しても、処理がスキップされても、テストの必要はありません。<br>
<br>
値の型や長さ、値の入力や null 判定など、DAOに問い合わせずとも実施できるチェックは、<br>
DAO を使用するフロント側のクラスで最初にチェックしておくべきこととなります。<br>
<br>
また、実装者自身しか使わないようなメソッドで、「引数に何がくるかよくわからない」 、というような状態になってしまっている場合は、<br>
仕様または、プログラムに問題があるといわざるを得ません。<br>
その時々に応じて、適切なメソッドの責任を考察するようにしてください。<br>
<br>
<br>

それでは実際に、MVC施設予約の単体テスト仕様書の作成に取り掛かりましょう。<br>
直交表として、以下のテンプレートを使用します。<br>
<br>
<a href="files/直交表テンプレートOpenOffice用.xls">直交表テンプレートOpenOffice用.xls</a>
<br>
<br>
<br>
<br>
<!-- 
<p class="midasi1">MVC施設予約単体テスト項目作成</p>

それでは実際に、MVC施設予約を例にとって単体テストを作成する手順を少し追っていきたいと思います。 ここで例にするMVC施設予約は
<ol>
	<li>jp.co.insightech.bbs.BBSServlet.java
	<li>jp.co.insightech.bbs.BBSModel.java
	<li>jp.co.insightech.bbs.BBSDao.ava
	<li>jp.co.insightech.bbs.BBSUtil.ava
	<li>jp.co.insightech.bbs.bbs.jsp
</ol>

の５つのファイルから構成されています。 ここで、JSP、Modelクラスの単体テストは必要ありませんので(※)、
<br>
サーブレット、Dao、ユーティリティクラスの単体テストを作成します。
<br>

<p>※JSPのテストは目視で実施します。<br>
また、Modelクラスに関していえば、getterやsetterはサーブレットやDaoで使用することになりますので、<br>
最初から単体テスト項目を作成する必要はありません。<br>
djunitのテストにて、カバレッジが100％を満たせず、かつModelクラスの中で通過していない場所がある際にのみ、部分的にテストを実施してください。
</p>


<dl>
	<dt>1. 単体テスト直交表）の作成</dt>
	<dd></dd>
	<dt>2. サーブレット単体テストの作成</dt>
	<dd>
	<dl>
		<dt>2.1. 入力パラメーターの列挙</dt>
		<dt>2.2. 出力パラメーターの列挙</dt>
		<dt>2.3. テストデータの決定</dt>
		<dt>2.4. 単体テスト項目を作成</dt>
	</dl>
	</dd>
	<dt>3. DAO単体テストの作成</dt>
	<dd>
	<dl>
		<dt>2.1. 入力パラメーターの列挙</dt>
		<dt>2.2. 出力パラメーターの列挙</dt>
		<dt>2.3. テストデータの決定</dt>
		<dt>2.4. 単体テスト項目を作成</dt>
	</dl>
	</dd>

</dl>

<p class="midasi1">単体テスト直交表（ディシジョンテーブル）の作成</p>

単体テストを実施するクラスのpublicメソッドを一覧にしてみます。

<table border="1">
	<tr>
		<th>テストクラス</th>
		<th>テストメソッド</th>
	</tr>

	<tr>
		<td rowspan="2">jp.co.insightech.bbs.BBSServlet</td>
		<td>void doGet()</td>
	</tr>

	<tr>
		<td>void doPost()</td>
	</tr>

	<tr>
		<td rowspan="3">jp.co.insightech.bbs.BBSDao</td>
		<td>BBSModel regist(BBSModel model);</td>
	</tr>

	<tr>
		<td>int delete(Integer bbsId, String password)</td>
	</tr>

	<tr>
		<td>Vector getAllBBSList()</td>
	</tr>

	<tr>
		<td>jp.co.insightech.bbs.BBSUtil</td>
		<td>String escapeStr(String str)</td>
	</tr>


</table>
<br>
メソッド１つにつき、１シート分の単体テスト項目を作成することになりますので、
<br>
最初に６シート分作成してしまい、クラス名、メソッド名を入力します。
<br>
この各シートに対し、以下の処理を繰り返してゆきます。
<br>

<ol>
	<li>入力パラメーターの列挙
	<li>出力パラメーターの列挙
	<li>テストデータの決定
	<li>単体テスト項目を作成
</ol>
<br>

<img src="images/00_02.png" alt="" />

<p class="midasi1">サーブレット単体テストの作成</p>


準備ができたので、単体テスト項目を考えていくことにします。
<br>
ここでは、「doPost()」メソッドを例にします。
<br>
<pre>
public void doPost(ActionMapping mapping,
                   ActionForm actionForm,
                   HttpServletRequest request,
                   HttpServletResponse response) {
  .....
  .....
}
</pre>

<p class="midasi2">入力パラメーターの列挙</p>

サーブレットの場合の入力項目は、
<ol>
	<li>リクエストパラメータ
	<li>セッションパラメーター
</ol>
ですので、
<pre>
String bbsId = request.getParameter("BBS_ID");
</pre>
や
<pre>
HttpSession session = request.getSession();
String loginId = session.getParameter("LOGIN_ID");
</pre>

の記述がされている部分が入力される可能性のあるパラメータをあらわす部分です。
<br>
<br>
ソースコードを見て、上記の観点から全てのパラメータを探します。
<br>

<h4>入力パラメータ一覧</h4>

<table border="1">
	<tr>
		<th></th>
		<th>パラメータ名</th>
		<th>名称</th>
		<th>必須</th>
		<th>型</th>
		<th>長さ</th>
		<th>スコープ</th>
		<th>画面コンポーネント型</th>
	</tr>

	<tr>
		<td>●</td>
		<td>NAME</td>
		<td>名前</td>
		<td>△</td>
		<td>文字列</td>
		<td>40</td>
		<td>request</td>
		<td>テキストボックス</td>
	</tr>

	<tr>
		<td>●</td>
		<td>MAIL_ADDRESS</td>
		<td>メールアドレス</td>
		<td></td>
		<td>英数字のアドレス形式</td>
		<td>40</td>
		<td>request</td>
		<td>テキストボックス</td>
	</tr>

	<tr>
		<td>●</td>
		<td>SUBJECT</td>
		<td>件名</td>
		<td></td>
		<td>文字列</td>
		<td>100</td>
		<td>request</td>
		<td>テキストボックス</td>
	</tr>

	<tr>
		<td>●</td>
		<td>MESSAGE</td>
		<td>メッセージ</td>
		<td>△</td>
		<td>文字列</td>
		<td>500</td>
		<td>request</td>
		<td>テキストエリア</td>
	</tr>
	<tr>
		<td>●</td>
		<td>MESSAGE_COLOR</td>
		<td>文字色</td>
		<td></td>
		<td>数字</td>
		<td>1</td>
		<td>request</td>
		<td>ラジオボタン</td>
	</tr>

	<tr>
		<td>●</td>
		<td>PASSWORD</td>
		<td>パスワード</td>
		<td>△</td>
		<td>数字</td>
		<td>4</td>
		<td>request</td>
		<td>パスワードボックス</td>
	</tr>

	<tr>
		<td>●</td>
		<td>DELETE_BBSID</td>
		<td>削除対象BBSID</td>
		<td>△</td>
		<td>数字</td>
		<td>10</td>
		<td>request</td>
		<td>隠し</td>
	</tr>

	<tr>
		<td>●</td>
		<td>DELETE_PASSWORD</td>
		<td>削除用パスワード</td>
		<td>△</td>
		<td>数字</td>
		<td>4</td>
		<td>request</td>
		<td>パスワードボックス</td>
	</tr>

	<tr>
		<td>●</td>
		<td>REGIST_BUTTON</td>
		<td>登録ボタン</td>
		<td></td>
		<td>文字列</td>
		<td>-</td>
		<td>request</td>
		<td>サブミットボタン</td>
	</tr>

	<tr>
		<td>●</td>
		<td>RESET_BUTTON</td>
		<td>リセットボタン</td>
		<td></td>
		<td>文字列</td>
		<td>-</td>
		<td>request</td>
		<td>サブミットボタン</td>
	</tr>

	<tr>
		<td>●</td>
		<td>DELETE_BUTTON</td>
		<td>削除ボタン</td>
		<td></td>
		<td>文字列</td>
		<td>-</td>
		<td>request</td>
		<td>サブミットボタン</td>
	</tr>
</table>
※△は条件付必須
<br>
<br>
ここで重要なのは、このdoPost()メソッドが受け付ける可能性のある全てのパラメータを書き出すことです。
<br>
ですから、画面上でHiddenで設定されている値や、ボタンから送信される値も取得しているため、ここに書き出します。
<br>
また、仕様として設定されている文字種や、長さ、必須かどうかなども重要なポイントになります。
<br>

<br>

<p class="midasi2">出力パラメーターの列挙</p>

さて、次にこのメソッドの出力/結果を考えて見ましょう。サーブレットの出力は

<ol>
	<li>メソッド実行の結果得られる、遷移先の情報
	<li>セッション内に格納される情報
	<li>リクエスト内に格納される情報
</ol>

であり、JSPなどで使用される情報となります。
<pre>
request.setAttribute("BBS_ID", bbsId);
</pre>
や、
<pre>
HttpSession session = request.getSession();
session.setAttribute("LOGIN_ID", loginId);

request.getRequestDispatcher("bbs.jsp").forward;

</pre>
などの記述をしている部分を探せばいいわけです。
<br>

そこで探してみると以下のような入力パラメータがあることがわかりました。

<h4>出力パラメータ一覧</h4>

<table border="1">
	<tr>
		<th></th>
		<th>パラメータ名</th>
		<th>名称</th>
		<th>スコープ</th>
	</tr>
	<tr>
		<td>●</td>
		<td>BBS_LIST</td>
		<td>画面に表示するBeanを格納した一覧リスト</td>
		<td>Session</td>
	</tr>
	<tr>
		<td>●</td>
		<td>SAVE_NAME</td>
		<td>エラー時に保存された名前</td>
		<td>request</td>
	</tr>
	<tr>
		<td>●</td>
		<td>SAVE_MAILADDRESS</td>
		<td>エラー時に保存されたメールアドレス</td>
		<td>request</td>
	</tr>
	<tr>
		<td>●</td>
		<td>SAVE_SUBJECT</td>
		<td>エラー時に保存された件名</td>
		<td>request</td>
	</tr>
	<tr>
		<td>●</td>
		<td>SAVE_MESSAGE</td>
		<td>エラー時に保存されたメッセージ</td>
		<td>request</td>
	</tr>
	<tr>
		<td>●</td>
		<td>SAVE_CHARCOLOR</td>
		<td>エラー時に保存された文字色</td>
		<td>request</td>
	</tr>
	<tr>
		<td>●</td>
		<td>ERROR_MESSAGE</td>
		<td>エラーメッセージ</td>
		<td>request</td>
	</tr>
	<tr>
		<td>●</td>
		<td>遷移先</td>
		<td>bbs.jsp</td>
		<td>-</td>
	</tr>
</table>
<br>
入力項目と出力項目を、テンプレートに反映します。
<br>
以下のような状態になります。
<br>

<br>
<img src="images/00_03.png" alt="" />

<br>
<br>

<p class="midasi2">テストデータの決定</p>

直交表ができましたが、まだ入力・出力項目のみしか列挙されていません。
<br>
単体テストをするためには、入力に使用する実際の値・出力される結果の値を決めなければいけません。
<br>
<br>

実際にどのような値を使用しても問題ありませんが、同じような結果が起こるであろう値をたくさんもテストしても
<br>
単体テスト項目を作成するのに時間がかかるだけで、モジュールの動作を保証するという点においてはあまり意味がありません。
<br>
単体テストも、開発のうちですのでいくらでも時間をかけていいものではなく、 短い時間で効果的な単体テストをすることが大切になります。
<br>
<br>

そこで、全ての処理分岐を通過するような入力データ、「同値分割」「境界値分析」に基づくようなデータをあげるために、
<br>
具体的に以下のような要素にポイントを絞ることにします。
<br>

<ol>
	<li>値の型と長さ
	<li>値が入力されるか、されないか
	<li>実際に存在する値と存在しない値
	<li>実装において処理を分岐させるために使用されている値
</ol>

サーブレットにおける注意事項を挙げてみると以下のようになります。
<ul>
	<li>画面を改ざんすることで、こちらで想定していない文字列をリクエストパラメータとして送信されることがある。
	<li>プレゼンテーション層として、リクエストパラメータに対する型や、長さのチェックを行う必要がある。
	<li>リクエストパラメータは "" (空文字)で送信される場合や null の場合がある。
	<li>サブミットボタンから送信されるリクエストパラメータなどで処理の分岐を分けている。
</ul>


<br>
これらを加味して、各入力項目欄、出力項目欄に実データを入れていきます。
<br>
例えば、REGIST_BUTTON（投稿ボタン）であれば、
<br>

<br>
<img src="images/00_04.png" alt="" border="1" />
<br>
<br>

PASSWORD （パスワード）であれば、
<br>

<br>
<img src="images/00_05.png" alt="" border="1" />
<br>
<br>

出力項目の、ERROR_MESSAGE（エラーメッセージ）であれば、
<br>

<br>
<img src="images/00_06.png" alt="" border="1" />
<br>
<br>

というようになります。


<pre>
同値分割は値を有効値のグループと無効値のグループに分け、そこから取り出した代表値を使用するというものです。

また、境界値分析は、上限に対して、その値とさらにそのひとつ上の値、
下限に対して、その値とさらにそのひとつ下の値というようにテストの値を決める方法です。

文字コード種や、数字の範囲、HTMLやSQLに対して効力を持つ文字列などの知識も必要です。
SQLインジェクション、クロスサイトスクリプティングなどの言葉を調べてみてください。
これらの方法論や入力値の種類などをどれだけ知っているかで、単体テスト作成は漏れがなく、そして無駄がないものになります。
</pre>


<p class="midasi2">単体テスト項目を作成</p>

実データが出揃ったら、入力・出力の組み合わせのパターンを考えてゆきます。
<br>
入力のデータについては、全ての組み合わせをN×Nで考えると際限がなくなりますので、プログラム上、起こりうる組み合わせのみに限定します。
<br>
例えば、今回、「削除パスワード」、「削除用BBSID」は、削除ボタンが押された場合にのみ取得しますので、
<br>
削除ボタンが押された（DELETE_BUTTON＝削除）の場合のみ以外は、この２つのパラメータは入力されてもされなくても同じと考え、入力パラメータとして取り上げません。
<br>

上記ルールを今回のMVC施設予約のソースを元に考慮して、入力データ・出力データの組み合わせを作成したものが下記資料となります。
<br>
見た目のわかりやすさのために着色しています。また、テストを実施するうえでの前提を表の下に書き加えました。
<br>
<br>

<img src="images/00_07.png" alt="" border="1" />
<br>
<br>

尚、長すぎるため、途中を省略しています。
<br>
正確な内容を見るというよりは、このような感じで仕上がるというイメージをつかんでください。
<br>

<br>
<img src="images/00_08.png" alt="" border="1" />


<p class="midasi1">DAO単体テストの作成</p>
次にDAOの単体テストをひとつ作成してみます。
<br>
ここでは、「regist()」メソッドを例にします。
<pre>
public BBSModel regist(BBSModel model) throws SQLException {
   ...
   ...
}
</pre>

<p class="midasi2">入力パラメーターの列挙</p>
まず、入力パラメーターの列挙を行います。
<br>
DAOやユーティリティクラスの場合の入力は、メソッドに渡される引数のパラメータ名ですので、
<pre>
public BBSModel regist(<font color="red">BBSModel model</font>) {
</pre>
の部分になります。
<br>
リテラルであればそのままですが、Javaのオブジェクトですので、この中のプロパティを挙げます。

<h4>入力パラメータ一覧</h4>

<table border="1">
	<tr>
		<th></th>
		<th>パラメータ名</th>
		<th>型</th>
		<th>プロパティ名</th>
		<th>型</th>
	</tr>

	<tr>
		<td>●</td>
		<td>BBSモデル</td>
		<td>BBSModel</td>
		<td>id</td>
		<td>int</td>
	</tr>

	<tr>
		<td>●</td>
		<td></td>
		<td></td>
		<td>name</td>
		<td>String</td>
	</tr>

	<tr>
		<td>●</td>
		<td></td>
		<td></td>
		<td>address</td>
		<td>String</td>
	</tr>

	<tr>
		<td>●</td>
		<td></td>
		<td></td>
		<td>subject</td>
		<td>String</td>

	</tr>

	<tr>
		<td>●</td>
		<td></td>
		<td></td>
		<td>message</td>
		<td>String</td>

	</tr>
	<tr>
		<td>●</td>
		<td></td>
		<td></td>
		<td>charColor</td>
		<td>int</td>

	</tr>

	<tr>
		<td>●</td>
		<td></td>
		<td></td>
		<td>password</td>
		<td>int</td>

	</tr>


</table>



<p class="midasi2">出力パラメーターの列挙</p>

次に、出力パラメーターの列挙を行います。
<br>
DAOやユーティリティクラスの場合の入力は、メソッドから戻される値や、スローされる例外などですので、
<pre>
public <font color="red">BBSModel</font> regist(BBSModel model) <font
	color="red">throws SQLException</font> {
</pre>
の部分になります。
<br>
リテラルであればそのままですが、Javaのオブジェクトですので、この中のプロパティを挙げます。

<h4>出力パラメータ一覧</h4>

<table border="1">
	<tr>
		<th></th>
		<th>パラメータ名</th>
		<th>型</th>
		<th>プロパティ名</th>
		<th>型</th>
	</tr>

	<tr>
		<td>●</td>
		<td>BBSモデル</td>
		<td>BBSModel</td>
		<td>id</td>
		<td>int</td>
	</tr>

	<tr>
		<td>●</td>
		<td></td>
		<td></td>
		<td>name</td>
		<td>String</td>
	</tr>

	<tr>
		<td>●</td>
		<td></td>
		<td></td>
		<td>address</td>
		<td>String</td>


	</tr>

	<tr>
		<td>●</td>
		<td></td>
		<td></td>
		<td>subject</td>
		<td>String</td>

	</tr>

	<tr>
		<td>●</td>
		<td></td>
		<td></td>
		<td>message</td>
		<td>String</td>

	</tr>
	<tr>
		<td>●</td>
		<td></td>
		<td></td>
		<td>charColor</td>
		<td>int</td>

	</tr>

	<tr>
		<td>●</td>
		<td></td>
		<td></td>
		<td>password</td>
		<td>int</td>
	</tr>

	<tr>
		<td>●</td>
		<td>SQL例外</td>
		<td>SQLException</td>
		<td colspan="2">IDが重複した場合</td>
	</tr>

</table>

<br>
また、DAOで忘れてはいけないのは実際のデータベース操作が正常に行われることを確認することです。
<br>
登録が終わった後には、以下のレコードが書き換えられることを確認します。

<h4>データベース内容</h4>

<table border="1">
	<tr>
		<th></th>
		<th>テーブル</th>
		<th>カラム名</th>
	</tr>

	<tr>
		<td>●</td>
		<td>BBS</td>
		<td>ID</td>
	</tr>

	<tr>
		<td>●</td>
		<td>-</td>
		<td>NAME</td>
	</tr>

	<tr>
		<td>●</td>
		<td>-</td>
		<td>ADDRESS</td>
	</tr>

	<tr>
		<td>●</td>
		<td>-</td>
		<td>SUBJECT</td>

	</tr>

	<tr>
		<td>●</td>
		<td>-</td>
		<td>MESSAGE</td>

	</tr>
	<tr>
		<td>●</td>
		<td>-</td>
		<td>MESSAGE_COLOR</td>

	</tr>

	<tr>
		<td>●</td>
		<td>-</td>
		<td>PASSWORD</td>
	</tr>

</table>

<br>
直交表へ反映してみます。

<br>
<img src="images/00_09.png" alt="" />


<p class="midasi2">テストデータの決定</p>

次に使用するテストデータを挙げます。DAOの場合は、サーブレットと違い、入力される値は型が保障されています。
<br>
また、値の長さや存在・非存在についても、DAOが呼ばれる段階ではチェック済みとして、こちらが想定する値のみ入力されることを前提とします。
<br>
また、DAO内ではロジックを記述すべきではないので、分岐処理も検索以外で発生することはあまりありません。
<br>
<br>
DAOにおける注意事項を挙げてみると以下のようになります。
<br>

<ul>
	<li>データベースに対する処理が正常に行えることをテストする。</li>
	<li>データベースには一意制約やNOT NULL制約、FOREIGN KEY制約などがある。</li>
	<li>検索結果の並び順は一意とする。</li>
	<li>タイムスタンプなど自動的に登録される日付についてはテストルールを設ける。</li>
</ul>

DAOの場合、入力についてはかなりの部分が保障されますので、テストする内容は、例外発生条件などに絞ることにします。
<br>

<p class="midasi2">単体テスト項目を作成</p>

決定したテストデータを直交表に反映します。
<br>

<br>
<img src="images/00_11.png" alt="" border="1" />
<br>
<img src="images/00_12.png" alt="" border="1" />
<br>

<br>
<br>

<p class="midasi1">MVC施設予約の単体テスト作成</p>
さて、MVC施設予約の単体テストを作成してみましょう。
<br>
MVC施設予約でも使用していた以下のテンプレートを使用してください。
<br>
<br>
<a href="files/テスト表テンプレート.xls">テスト表テンプレート.xls</a>
<br>

MVC施設予約の単体テスト項目ができたら、一度レビューを受けて修正がないようであれば次のステップに進んでください。
<br>



<p class="midasi1">JUnitを使用した単体テスト項目作成</p>

単体テスト項目ができたら、次にJUnitを使用して、テストを実施していきます。
<br>
JUnitテストの作成方法については既に習得済みであることを前提としますので、以下の手順で実装を進めてください。
<br>

<ol>
	<li>自分で作成したMVC施設予約をEclipse上のプロジェクトとして導入する。
	<li>Eclipse上でdjunit、dbunitを使用できる環境を整備する。（→実際の作成手順）
	<li>テスト用のフォルダを作成し、使用するリソースを追加する。（→実際の作成手順）
	<li>単体テスト項目のシート分のJUnitクラスを作成する。
	<li>単体テスト項目を元に、メソッドを作成しJavaDocを記入する。
	<li>JavaDocコメントに沿って、テストメソッドの実装を行う。
</ol>
<br>
JavaDocの記述方法は以下のフォーマットに沿ってください。
<br>
&lt;pre&gt;タグは入れるようにしてください。（JavaDoc生成時のため）
<br>
<br>

<pre>
/**
 * &lt;pre&gt;
 * 【概要】
 * 存在するBBSIDを、間違ったパスワードで削除できないこと。
 *
 * 【条件】
 * requestの情報
 * ・REGIST_BUTTON : null
 * ・RESET_BUTTON  : null
 * ・DELETE_BUTTON : 削除
 * ・DELETE_BBSID  : 1
 * ・DELETE_PASWORD : dummy_password
 *
 * 【実行】 
 * ・doPost
 *
 * 【結果】
 * requestの情報
 * ・ERROR_MESSAGE : パスワードが間違っています。
 * ・bbs.jsp に遷移すること。
 * &lt;/pre&gt;
 *
 */
</pre>

また、データベースを使用したテストの場合は、DBUnitを使用し、今回は流し込みデータ、検証データとしてXMLを使用します。
<br>
使用するXML名を入力するようにしてください。

<pre>
/**
 * &lt;pre&gt;
 * 【概要】
 * BBSが一件投稿されること。
 *
 * 【条件】
 * ・DBの状態   : init_data.xml
 * ・引数 model
 *   id         : 99
 *   name       : 氏　名
 *   address    : xxxxxx@yyy.co.jp
 *   subject    : 前回の投稿について
 *   message    : こんにちは\nお元気ですか。
 *   charColor  : 1
 *   password   : 1111
 *   registDate : 2008-08-24 12:33:00
 *
 * 【実行】 
 * ・regist
 *
 * 【結果】
 * ・DBの状態   : regist_result.xml
 * ・戻り値 BBSModel
 *   id         : 99
 *   name       : 氏　名
 *   address    : xxxxxx@yyy.co.jp
 *   subject    : 前回の投稿について
 *   message    : こんにちは\nお元気ですか。
 *   charColor  : 1
 *   password   : 1111
 *   registDate : 2008-08-24 12:33:00
 * 
 * &lt;/pre&gt;
 *
 */
</pre>

 -->

<br>
<br>

<hr>
<center>&copy;日本インサイトテクノロジー株式会社</center>
<br>
<br>
<br>

</body>
</html>
